import{G as F,a as T,X as U,C as R,Y as G,r as f,Z as S,h as w,j as i,B as M,_ as it,b as I,O as _,m as D,c as B,f as z,$ as rt,F as ct,i as k,k as O,a0 as Q,a1 as W,n as H,l as L,D as q,e as Y,d as ut,u as lt,g as ft,q as j,a2 as mt,a3 as Z,t as pt,a4 as dt,y as gt}from"./index.b957ffd4.js";function ht(t){return F({tag:"svg",attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M847.9 592H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h605.2L612.9 851c-4.1 5.2-.4 13 6.3 13h72.5c4.9 0 9.5-2.2 12.6-6.1l168.8-214.1c16.5-21 1.6-51.8-25.2-51.8zM872 356H266.8l144.3-183c4.1-5.2.4-13-6.3-13h-72.5c-4.9 0-9.5 2.2-12.6 6.1L150.9 380.2c-16.5 21-1.6 51.8 25.1 51.8h696c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]})(t)}var r=(t=>(t.from="from",t.to="to",t))(r||{}),d=(t=>(t[t.SelectToken=0]="SelectToken",t[t.EnterAmount=1]="EnterAmount",t[t.InsufficientBalance=2]="InsufficientBalance",t[t.InsufficientAmount=3]="InsufficientAmount",t[t.InsufficientLiquidity=4]="InsufficientLiquidity",t[t.Swap=5]="Swap",t))(d||{});const wt=T(r.from),It=T([R[0],R[1]]),K=T(!1),X=()=>U(K),yt=()=>{const t=G(K),e=f.exports.useRef(0);return s=>{t(s),s&&(clearTimeout(e.current),e.current=Number(setTimeout(()=>{t(!1)},600)))}},J=T(!1),xt=T(null),At={wrapper:"flex items-center gap-3 my-4 px-2 text-sm text-gray-400"};function vt(t,e){return!e||!t?"":(it(e,t)*I(_)/I(_)).toFixed(6)}const N=(t,e)=>({symbol:t||"",amount:e||S});function St({swapState:t,previewAmount:e,isLoading:s}){const[[n,a],o]=f.exports.useState([null,null]),m=X();f.exports.useEffect(()=>{t?.direction===r.from?o([N(t.coinFrom.symbol,t.amount),N(t.coinTo.symbol,e)]):t&&o([N(t.coinFrom.symbol,e),N(t.coinTo.symbol,t.amount)])},[t,e]);function c(){o([a,n])}if(m||s||!n?.amount||!a?.amount)return null;const p=vt(n.amount,a.amount);return w("div",{className:At.wrapper,children:[w("div",{children:[i("span",{className:"text-gray-200",children:"1"})," ",n.symbol," ="," ",i("span",{className:"text-gray-200",children:p})," ",a.symbol]}),i(M,{size:"sm",className:"h-auto p-0 border-none",onPress:c,children:i(ht,{size:20})})]})}function V(t){return F({tag:"svg",attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M8 1a.5.5 0 0 1 .5.5v11.793l3.146-3.147a.5.5 0 0 1 .708.708l-4 4a.5.5 0 0 1-.708 0l-4-4a.5.5 0 0 1 .708-.708L7.5 13.293V1.5A.5.5 0 0 1 8 1z"}}]})(t)}function Tt(t){return F({tag:"svg",attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M8 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L7.5 2.707V14.5a.5.5 0 0 0 .5.5z"}}]})(t)}const y={confirmButton:`
    p-0 relative w-12 h-12
    border-2 border-gray-700 bg-gray-800 rounded-2xl cursor-pointer
    text-gray-400 hover:text-gray-50
  `,icon:"transition-all",iconLeft:"translate-x-[6px]",iconRight:"translate-x-[-6px]",rotate:"rotate-180"};function bt({onClick:t}){const[e,s]=f.exports.useState(!1);function n(){s(a=>!a),t?.()}return w(M,{onPress:n,className:y.confirmButton,"aria-label":"Invert coins",children:[i(V,{size:24,className:D(y.icon,y.iconLeft,{[y.rotate]:e})}),i(Tt,{size:24,className:D(y.icon,y.iconRight,{[y.rotate]:e})})]})}const Nt={switchDirection:"flex items-center justify-center -my-5"};function Pt({onChange:t,isLoading:e,previewAmount:s}){const[n,a]=B(xt),[o,m]=B(wt),[[c,p],g]=B(It),b=U(J),v=yt(),E=()=>{if(v(!0),o===r.to){const h=l.amount;f.exports.startTransition(()=>{m(r.from),l.setAmount(u.amount),u.setAmount(h)})}else{const h=u.amount;f.exports.startTransition(()=>{m(r.to),u.setAmount(l.amount),l.setAmount(h)})}g([p,c])},l=z({coin:c,disableWhenEth:!0,gasFee:rt(Q),onChangeCoin:h=>{g([h,p])},onInput:()=>{v(!0),m(r.from)}}),u=z({coin:p,disableWhenEth:!0,onChangeCoin:h=>{g([c,h])},onInput:()=>{v(!0),m(r.to)}});return f.exports.useEffect(()=>{o===r.to?u.setAmount(n):l.setAmount(n)},[]),f.exports.useEffect(()=>{const x=(o===r.from?l:u).amount;o===r.from&&x===null&&u.setAmount(null),o===r.to&&x===null&&l.setAmount(null),a(x),c&&p&&t?.({amount:x,amountFrom:l.amount,coinFrom:c,coinTo:p,direction:o,hasBalance:l.hasEnoughBalance})},[l.amount,u.amount,c,p]),f.exports.useEffect(()=>{o===r.from?u.setAmount(s||null):l.setAmount(s||null)},[s]),f.exports.useEffect(()=>{b&&(u.setAmount(null),l.setAmount(null))},[b]),w(ct,{children:[i("div",{className:"mt-4",children:i(k,{...l.getInputProps(),...o===r.to&&{isLoading:e},autoFocus:o===r.from,rightElement:i(O,{...l.getCoinSelectorProps()})})}),i("div",{className:Nt.switchDirection,children:i(bt,{onClick:E})}),i("div",{className:"mb-4",children:i(k,{...u.getInputProps(),...o===r.from&&{isLoading:e},autoFocus:o===r.to,rightElement:i(O,{...u.getCoinSelectorProps()})})})]})}function P(t,e,s,n){const a=I(e)/I(t),o=I(s)/I(n);return((a/o-1)*100).toFixed(2)}const Ct=({direction:t,amount:e,coinFrom:s,previewAmount:n,token_reserve:a,eth_reserve:o})=>!n||!e||!a||!o?"0":t===r.from?s?.assetId!==W?P(n,e,a,o):P(n,e,o,a):s?.assetId!==W?P(e,n,a,o):P(e,n,o,a),tt=(t,e,s)=>{let n=0;return s===r.from?n=I(t)*(1-e):n=I(t)*(1+e),Math.trunc(n)},C=({title:t,value:e,className:s})=>w("div",{className:D("flex",s),children:[i("div",{children:t}),i("div",{className:"flex-auto text-right",children:e})]}),Et=({title:t,children:e,className:s})=>w("div",{className:s,children:[i("div",{className:"px-2 text-sm text-gray-50 mb-2",children:t}),i("div",{className:"flex flex-col gap-3 p-4 text-sm text-gray-100 bg-gray-700 rounded-xl",children:e})]});function et(){return{value:H,formatted:`${H*100}%`}}function Bt({swapInfo:t,isLoading:e}){const{amount:s,previewAmount:n,direction:a,coinFrom:o,coinTo:m}=t,c=X(),p=et();if(!o||!m||!n||!a||!s||e||c)return null;const g=L.formatUnits(a===r.from?n:s||S,q);return w("div",{children:[i("div",{className:"flex justify-center",children:i(V,{size:24})}),w(Et,{title:"Expected out:",className:"my-2",children:[i(C,{title:"You'll receive:",value:`${g} ${m.symbol}`}),i(C,{title:"Price impact: ",value:`${Ct(t)}%`}),i(C,{title:`${a===r.from?"Minimum received after slippage":"Maximum sent after slippage"} (${p.formatted}):`,value:`${L.formatUnits(tt(n,p.value,a),q)} ${a===r.from?m.symbol:o.symbol}`}),i(C,{className:"text-gray-300",title:"Network Fee",value:`${L.formatUnits(Q,q)} ETH`})]})]})}const nt=async(t,e,s)=>await t.callStatic.get_swap_with_maximum(s,{forward:[0,e]}),st=async(t,e,s)=>await t.callStatic.get_swap_with_minimum(s,{forward:[0,e]}),Lt=async(t,{amount:e,direction:s,coinFrom:n})=>s===r.to&&e?await nt(t,n.assetId,e):e?await st(t,n.assetId,e):null,qt=async(t,{coinFrom:e,direction:s,amount:n})=>{if(s===r.to&&n){const o=await nt(t,e.assetId,n);if(!o.has_liquidity)throw new Error("Not enough liquidity on pool");await t.functions.swap_with_maximum(n,1e3,{forward:[o.amount,e.assetId],variableOutputs:1})}else if(s===r.from&&n){const o=await st(t,e.assetId,n);if(!o.has_liquidity)throw new Error("Not enough liquidity on pool");await t.functions.swap_with_minimum(o.amount,1e3,{forward:[n,e.assetId],variableOutputs:1})}};function Dt(t,e=300){const[s,n]=f.exports.useState(t);return f.exports.useEffect(()=>{const a=setTimeout(()=>{n(t)},e);return()=>{clearTimeout(a)}},[t,e]),s}function Ft(t){return Y("PoolPage-poolInfo",()=>t.callStatic.get_info())}const Mt=(t,e)=>{switch(t){case d.SelectToken:return"Select token";case d.EnterAmount:return"Enter amount";case d.InsufficientBalance:return`Insufficient ${e?.coinFrom.symbol||""} balance`;case d.InsufficientAmount:return"Insufficient amount to swap";case d.InsufficientLiquidity:return"Insufficient liquidity";default:return"Swap"}},$t=({swapState:t,previewAmount:e,slippage:s,balances:n})=>{if(t.direction===r.to){const a=tt(e||S,s,t.direction),o=I(n?.find(m=>m.assetId===t.coinFrom.assetId)?.amount||S);return a>o}return!1},Rt=t=>{const{swapState:e,previewAmount:s,hasLiquidity:n}=t;return!e?.coinFrom||!e?.coinTo?d.SelectToken:e?.amount?!e.hasBalance||$t(t)?d.InsufficientBalance:!n||Z(s)?d.InsufficientLiquidity:d.Swap:d.EnterAmount};function zt(){const t=ut(),[e,s]=f.exports.useState(null),[n,a]=f.exports.useState(null),[o,m]=f.exports.useState(!0),c=Dt(n),{data:p}=Ft(t),g=e?.amount||S,b=f.exports.useMemo(()=>({...p,...e,...n,previewAmount:g}),[p,e,n]),v=et(),{data:E}=lt(),l=G(J),{isLoading:u}=Y(["SwapPage-inactiveAmount",c?.amount?.toString(),c?.direction,c?.coinFrom.assetId,c?.coinTo.assetId],async()=>c?.amount?Lt(t,c):null,{onSuccess:A=>{A!=null&&(Z(A.amount)?(s(null),m(!1)):(m(A.has_liquidity),s(A)))}}),{mutate:h,isLoading:x}=ft(async()=>{!n||(await qt(t,n),await gt(1e3))},{onSuccess:()=>{l(!0),pt.success("Swap made successfully!"),dt.refetchQueries(["AssetsPage-balances"])}});function ot(A){a(A)}const $=Rt({swapState:n,balances:E,slippage:v.value,previewAmount:g,hasLiquidity:o}),at=u||$!==d.Swap;return w(j,{className:"self-start min-w-[450px] mt-24",children:[w(j.Title,{children:[i(mt,{className:"text-primary-500"}),"Swap"]}),i(Pt,{previewAmount:g,onChange:ot,isLoading:u}),i(Bt,{isLoading:u,swapInfo:b}),i(St,{swapState:n,previewAmount:g,isLoading:u}),i(M,{isFull:!0,isLoading:x,size:"lg",variant:"primary",isDisabled:at,onPress:()=>h(),children:Mt($,n)})]})}export{zt as default};
