import{G,a as W,p as P,j as l,b as o,O as Z,Z as T,t as F,d as v,c as Q,e as U,E as D,F as O,T as q,f as $,r as y,u as J,g as K,h as X,i as C,k as ee,D as te,l as I,C as B,m as k,n as L,o as M,q as S,B as oe,s as ae,S as se,v as ie}from"./index.c46161c3.js";import{B as ne}from"./index.esm.be4a4f40.js";import{u as _,a as z}from"./useCoinMetadata.bb91b978.js";import{P as R,a as N,u as re}from"./PreviewTable.d70e51e5.js";import{N as le}from"./NavigateBackButton.49d78a62.js";function ce(e){return G({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"g",attr:{},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M10 15.172l9.192-9.193 1.415 1.414L10 18l-6.364-6.364 1.414-1.414z"}}]}]})(e)}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const ue=({coinFrom:e,coinTo:t,reservesFromToRatio:n})=>{const r=W(Z),a=n,s=P(Math.floor(r/a)),u=P(Math.floor(r*1*a));return l("div",{children:[o("h4",{className:"ml-2 mb-2 text-gray-200 text-sm",children:"Pool price"}),o("div",{className:"mb-4 text-sm border border-dashed border-gray-500 py-3 px-4 rounded-lg",children:l("div",{className:"flex flex-col font-mono text-gray-300",children:[l("span",{children:["1 ",e.name," = ",s," ",t.name]}),l("span",{children:["1 ",t.name," = ",u," ",e.name]})]})})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function he({fromInput:e,poolInfo:t}){const{totalLiquidity:n,poolTokensNum:r}=_(),a=(e.amount||T)*F(n),s=v(a,n),u=s+Q(t?.lp_token_supply||BigInt(0)),g=v(BigInt(s)+r,BigInt(u))||1;let h=P(s);const A=U(g*100);return t?.eth_reserve===T&&(h=P(e.amount||0)),{liquidityFactor:a,previewTokens:s,nextCurrentPoolShare:g,nextTotalTokenSupply:u,formattedPreviewTokens:h,formattedNextCurrentPoolShare:A}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const de=({poolInfo:e,fromInput:t})=>{const{coinMetaData:n}=z({symbol:D.name}),r=n?.pairOf?.[0],a=n?.pairOf?.[1],{formattedPreviewTokens:s,formattedNextCurrentPoolShare:u}=he({fromInput:t,poolInfo:e});return l(O,{children:[o("div",{className:"flex justify-center",children:o(ne,{size:20,className:"text-gray-400"})}),l(R,{title:"Expected output:",className:"mt-2 mb-4",children:[o(N,{title:"Pool tokens you'll receive:",value:l("div",{className:"flex flex-1 items-center justify-end",children:[s," ",o(q,{coinFrom:r,coinTo:a,size:14})]})}),o(N,{title:"Your share of current pool:",value:`${u}%`})]})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const me=()=>{const{formattedEthReserve:e,formattedTokenReserve:t}=_(),{coinMetaData:n}=z({symbol:D.name}),r=n?.pairOf?.[0],a=n?.pairOf?.[1];return l(R,{title:"Current pool reserves",className:"mt-4",children:[o(N,{title:l("div",{className:"inline-flex items-center gap-2",children:[o(q,{coinFrom:r,size:14}),r?.name]}),value:e}),o(N,{title:l("div",{className:"inline-flex items-center gap-2",children:[o(q,{coinFrom:a,size:14}),a?.name]}),value:t})]})};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const V=globalThis.jotaiAtomCache.get("/home/runner/work/swayswap/swayswap/packages/app/src/pages/PoolPage/jotai.ts/poolFromAmountAtom",$(null));V.debugLabel="poolFromAmountAtom";const H=globalThis.jotaiAtomCache.get("/home/runner/work/swayswap/swayswap/packages/app/src/pages/PoolPage/jotai.ts/poolToAmountAtom",$(null));H.debugLabel="poolToAmountAtom";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function ge({fromInput:e,toInput:t,poolInfoQuery:n,coinFrom:r,coinTo:a,reservesFromToRatio:s}){const[u,g]=y.exports.useState([]),h=J(),[A,b]=y.exports.useState(0),E=K(),c=X(async()=>{const i=e.amount,p=t.amount;if(!i||!p)return;await h.submit.deposit({forward:[i,r.assetId]}),b(f=>f+1),await h.submit.deposit({forward:[p,a.assetId]}),b(f=>f+1);const w=await h.submit.add_liquidity(1,te,{variableOutputs:2,gasLimit:1e8});return b(f=>f+1),w},{onSuccess:i=>{i?C.success(s?"Added liquidity to the pool.":"New pool created."):C.error(`Error when trying to ${s?"add liquidity to":"create"} this pool.`),e.setAmount(BigInt(0)),t.setAmount(BigInt(0))},onError:i=>{const p=i?.response?.errors;p?.length?p[0].message==="enough coins could not be found"&&C.error(`Not enough balance in your wallet to ${s?"add liquidity to":"create"} this pool.`):C.error(`Error when trying to ${s?"add liquidity to":"create"} this pool.`)},onSettled:async()=>{await n.refetch(),await ee(),E("../"),b(0)}}),d=()=>{const i=[];return e.amount||i.push(`Enter ${r.name} amount`),t.amount||i.push(`Enter ${a.name} amount`),e.hasEnoughBalance||i.push(`Insufficient ${r.name} balance`),t.hasEnoughBalance||i.push(`Insufficient ${a.name} balance`),i};return y.exports.useEffect(()=>{g(d())},[e.amount,t.amount,e.hasEnoughBalance,t.hasEnoughBalance,s]),{stage:A,mutation:c,errorsCreatePull:u}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const pe={wrapper:"self-start max-w-[500px] mt-24",content:"bg-gray-800 w-[30rem] rounded-2xl p-4 m-2",formHeader:"px-2 flex items-center justify-between font-semibold text-xl",createPoolInfo:`font-mono my-4 px-4 py-3 text-sm text-slate-400 decoration-1 border border-dashed
  border-white/10 rounded-lg w-full`};function fe({loading:e,step:t,steps:n}){return o("ul",{className:"w-full rounded-lg border border-gray-600 text-gray-900",children:n.map((r,a)=>l("li",{className:ae("space-between flex w-full items-center border-b border-gray-600 px-6 py-2 text-white",{"rounded-t-lg":a===0,"bg-primary-500":t===a&&e,"rounded-b-lg":a===n.length}),children:[o("div",{className:"flex-1",children:r}),t===a&&e&&o(se,{}),t>a&&o(ce,{})]},a))})}function xe(){const[e,t]=I(V),[n,r]=I(H),[[a,s],u]=y.exports.useState([B[0],B[1]]),g=re(),{data:h,isLoading:A}=g,b=m=>{if(c.setAmount(m),i){const j=Math.ceil(v(m||T,i));d.setAmount(BigInt(j))}},E=m=>{if(d.setAmount(m),i){const j=Math.floor(ie(m||T,i));c.setAmount(BigInt(j))}},c=k({coin:a,disableWhenEth:!0,onChangeCoin:m=>u([m,s]),gasFee:F(1),onChange:b}),d=k({coin:s,disableWhenEth:!0,onChangeCoin:m=>u([m,s]),onChange:E}),i=v(h?.eth_reserve,h?.token_reserve),p=v(c.amount,d.amount),{mutation:w,stage:f,errorsCreatePull:x}=ge({fromInput:c,toInput:d,poolInfoQuery:g,coinFrom:a,coinTo:s,reservesFromToRatio:i});return y.exports.useEffect(()=>{c.setAmount(e),d.setAmount(n)},[]),y.exports.useEffect(()=>{t(c.amount),r(d.amount)},[c.amount,d.amount]),l(L,{className:"max-w-[450px]",children:[o(L.Title,{children:l("div",{className:"flex items-center",children:[o(le,{}),"Add Liquidity"]})}),w.isLoading?o("div",{className:"mt-6 mb-8 flex justify-center",children:o(fe,{steps:[`Deposit: ${a.name}`,`Deposit: ${s.name}`,"Provide liquidity","Done"],step:f,loading:w.isLoading,coinFrom:a,coinTo:s})}):l(O,{children:[l("div",{className:"space-y-4 my-4",children:[o(M,{autoFocus:!0,...c.getInputProps(),rightElement:o(S,{...c.getCoinSelectorProps()})}),o(M,{...d.getInputProps(),rightElement:o(S,{...d.getCoinSelectorProps(),isReadOnly:!0})})]}),o(de,{poolInfo:h,fromInput:c}),o(ue,{coinFrom:a,coinTo:s,reservesFromToRatio:i||p||1}),o(oe,{isDisabled:!!x.length,isFull:!0,size:"lg",variant:"primary",onPress:x.length?void 0:()=>w.mutate(),children:x.length?x[0]:i?"Add liquidity":"Create liquidity"}),!i&&!A?l("div",{className:pe.createPoolInfo,children:[o("h4",{className:"text-orange-400 mb-2 font-bold",children:"You are creating a new pool"}),o("div",{className:"flex",children:"You are the first to provide liquidity to this pool. The ratio between these tokens will set the price of this pool."})]}):null,!!(h&&i)&&o(me,{})]})]})}export{xe as default};
