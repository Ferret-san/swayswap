import{G as ut,f as C,a9 as Q,C as $,aa as Y,r as h,Z as x,j as d,b as c,B as q,d as B,c as M,O as _,e as lt,s as O,l as E,ab as ht,m as H,t as mt,ac as J,F as pt,o as W,q as z,ad as k,v as G,ae as U,p as L,u as ft,x as gt,w as wt,h as dt,n as Z,af as At,ag as X,i as yt,k as bt,ah as It}from"./index.187397a2.js";import{B as V,b as Tt}from"./index.esm.2717e667.js";import{P as xt,a as j,u as Ct}from"./PreviewTable.24eb9e3e.js";function St(t){return ut({tag:"svg",attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M847.9 592H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h605.2L612.9 851c-4.1 5.2-.4 13 6.3 13h72.5c4.9 0 9.5-2.2 12.6-6.1l168.8-214.1c16.5-21 1.6-51.8-25.2-51.8zM872 356H266.8l144.3-183c4.1-5.2.4-13-6.3-13h-72.5c-4.9 0-9.5 2.2-12.6 6.1L150.9 380.2c-16.5 21-1.6 51.8 25.1 51.8h696c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]})(t)}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,e){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,e),e)}};var i=(t=>(t.from="from",t.to="to",t))(i||{}),f=(t=>(t[t.SelectToken=0]="SelectToken",t[t.EnterAmount=1]="EnterAmount",t[t.InsufficientBalance=2]="InsufficientBalance",t[t.InsufficientAmount=3]="InsufficientAmount",t[t.InsufficientLiquidity=4]="InsufficientLiquidity",t[t.Swap=5]="Swap",t))(f||{});globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,e){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,e),e)}};const tt=globalThis.jotaiAtomCache.get("/home/runner/work/swayswap/swayswap/packages/app/src/pages/SwapPage/jotai.ts/swapActiveInputAtom",C(i.from));tt.debugLabel="swapActiveInputAtom";const et=globalThis.jotaiAtomCache.get("/home/runner/work/swayswap/swayswap/packages/app/src/pages/SwapPage/jotai.ts/swapCoinsAtom",C([$[0],$[1]]));et.debugLabel="swapCoinsAtom";const F=globalThis.jotaiAtomCache.get("/home/runner/work/swayswap/swayswap/packages/app/src/pages/SwapPage/jotai.ts/swapIsTypingAtom",C(!1));F.debugLabel="swapIsTypingAtom";const st=()=>Q(F),jt=()=>{const t=Y(F),e=h.exports.useRef(0);return a=>{t(a),a&&(clearTimeout(e.current),e.current=Number(setTimeout(()=>{t(!1)},600)))}},D=globalThis.jotaiAtomCache.get("/home/runner/work/swayswap/swayswap/packages/app/src/pages/SwapPage/jotai.ts/swapHasSwappedAtom",C(!1));D.debugLabel="swapHasSwappedAtom";const at=globalThis.jotaiAtomCache.get("/home/runner/work/swayswap/swayswap/packages/app/src/pages/SwapPage/jotai.ts/swapAmountAtom",C(null));at.debugLabel="swapAmountAtom";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,e){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,e),e)}};const K={wrapper:"flex items-center gap-3 my-4 px-2 text-sm text-gray-400",priceContainer:"min-w-[150px] cursor-pointer"};function vt(t,e){if(!e||!t)return"";const s=B(e,t)*M(_);return lt(s/M(_))}const v=(t,e)=>({symbol:t||"",amount:e||x});function Nt({swapState:t,previewAmount:e,isLoading:a}){const[[s,n],o]=h.exports.useState([null,null]),l=st();h.exports.useEffect(()=>{t?.direction===i.from?o([v(t.coinFrom.symbol,t.amount),v(t.coinTo.symbol,e)]):t&&o([v(t.coinFrom.symbol,e),v(t.coinTo.symbol,t.amount)])},[t,e]);function r(){o([n,s])}if(l||a||!s?.amount||!n?.amount)return null;const m=vt(s.amount,n.amount);return d("div",{className:K.wrapper,onClick:r,children:[d("div",{className:K.priceContainer,children:[c("span",{className:"text-gray-200",children:"1"})," ",s.symbol," ="," ",c("span",{className:"text-gray-200",children:m})," ",n.symbol]}),c(q,{size:"sm",className:"h-auto p-0 border-none",onPress:r,children:c(St,{size:20})})]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,e){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,e),e)}};const y={confirmButton:`
    p-0 relative w-10 h-10 rounded-lg mb-3 mt-0 translate-x-[60px]
    border-2 border-gray-700 bg-gray-800 cursor-pointer text-gray-400
    sm:translate-x-0 sm:my-1 sm:w-12 sm:h-12 sm:rounded-2xl hover:text-gray-50`,icon:"transition-all",iconLeft:"translate-x-[6px]",iconRight:"translate-x-[-6px]",rotate:"rotate-180"};function Pt({onClick:t}){const[e,a]=h.exports.useState(!1);function s(){a(n=>!n),t?.()}return d(q,{onPress:s,className:y.confirmButton,"aria-label":"Invert coins",children:[c(V,{size:24,className:O(y.icon,y.iconLeft,{[y.rotate]:e})}),c(Tt,{size:24,className:O(y.icon,y.iconRight,{[y.rotate]:e})})]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,e){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,e),e)}};const Et={switchDirection:"flex items-center sm:justify-center -my-5"};function Lt({onChange:t,isLoading:e,previewAmount:a}){const[s,n]=E(at),[o,l]=E(tt),[[r,m],g]=E(et),b=Q(D),A=jt(),[S]=ht(),P=()=>{if(A(!0),o===i.to){const w=u.amount;h.exports.startTransition(()=>{l(i.from),u.setAmount(p.amount),p.setAmount(w)})}else{const w=p.amount;h.exports.startTransition(()=>{l(i.to),p.setAmount(u.amount),u.setAmount(w)})}g([m,r])},u=H({coin:r,disableWhenEth:!0,gasFee:mt(J),onChangeCoin:w=>{g([w,m])},onInput:()=>{A(!0),l(i.from)}}),p=H({coin:m,disableWhenEth:!0,onChangeCoin:w=>{g([r,w])},onInput:()=>{A(!0),l(i.to)}});return h.exports.useEffect(()=>{o===i.to?p.setAmount(s):u.setAmount(s)},[]),h.exports.useEffect(()=>{const I=(o===i.from?u:p).amount;o===i.from&&I===null&&p.setAmount(null),o===i.to&&I===null&&u.setAmount(null),n(I),r&&m&&t?.({amount:I,amountFrom:u.amount,coinFrom:r,coinTo:m,direction:o,hasBalance:u.hasEnoughBalance})},[u.amount,p.amount,r,m]),h.exports.useEffect(()=>{o===i.from?p.setAmount(a||null):u.setAmount(a||null)},[a]),h.exports.useEffect(()=>{b&&(p.setAmount(null),u.setAmount(null))},[b]),d(pt,{children:[c("div",{className:"mt-4",children:c(W,{...u.getInputProps(),...o===i.to&&{isLoading:e},autoFocus:!S.isNew&&o===i.from,rightElement:c(z,{...u.getCoinSelectorProps()})})}),c("div",{className:Et.switchDirection,children:c(Pt,{onClick:P})}),c("div",{className:"mb-4",children:c(W,{...p.getInputProps(),...o===i.from&&{isLoading:e},autoFocus:!S.isNew&&o===i.to,rightElement:c(z,{...p.getCoinSelectorProps()})})})]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,e){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,e),e)}};function N(t,e,a,s){const n=B(e,t),o=B(a,s),l=(n/o-1)*100;return l>100?100:l.toFixed(2)}const Bt=({direction:t,amount:e,coinFrom:a,previewAmount:s,token_reserve:n,eth_reserve:o})=>!s||!e||!n||!o?"0":t===i.from?a?.assetId!==k?N(s,e,n,o):N(s,e,o,n):a?.assetId!==k?N(e,s,n,o):N(e,s,o,n),ot=(t,e,a)=>{let s=0;return a===i.from?s=G(t,1-e):s=G(t,1+e),BigInt(Math.trunc(s))};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,e){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,e),e)}};function nt(){return{value:U,formatted:`${U*100}%`}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,e){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,e),e)}};function Mt({swapInfo:t,isLoading:e}){const{amount:a,previewAmount:s,direction:n,coinFrom:o,coinTo:l}=t,r=st(),m=nt();if(!o||!l||!s||!n||!a||e||r)return null;const g=L(n===i.from?s:a||x),b=L(ot(s,m.value,n)),A=L(J);return d("div",{children:[c("div",{className:"flex justify-center",children:c(V,{size:20,className:"text-gray-400"})}),d(xt,{title:"Expected out:",className:"my-2",children:[c(j,{title:"You'll receive:",value:`${g} ${l.symbol}`}),c(j,{title:"Price impact: ",value:`${Bt(t)}%`}),c(j,{title:`${n===i.from?"Min. received after slippage":"Max. sent after slippage"} (${m.formatted}):`,value:`${b} ${n===i.from?l.symbol:o.symbol}`}),c(j,{className:"text-gray-300",title:"Network Fee",value:`${A} ETH`})]})]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,e){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,e),e)}};const it=async(t,e,a)=>await t.dryRun.get_swap_with_maximum(a,{forward:[0,e]}),ct=async(t,e,a)=>await t.dryRun.get_swap_with_minimum(a,{forward:[0,e]}),kt=async(t,{amount:e,direction:a,coinFrom:s})=>a===i.to&&e?await it(t,s.assetId,e):e?await ct(t,s.assetId,e):null,qt=async(t,{coinFrom:e,direction:a,amount:s})=>{if(a===i.to&&s){const o=await it(t,e.assetId,s);if(!o.has_liquidity)throw new Error("Not enough liquidity on pool");await t.submit.swap_with_maximum(s,1e3,{forward:[o.amount,e.assetId],variableOutputs:1})}else if(a===i.from&&s){const o=await ct(t,e.assetId,s);if(!o.has_liquidity)throw new Error("Not enough liquidity on pool");await t.submit.swap_with_minimum(o.amount,1e3,{forward:[s,e.assetId],variableOutputs:1})}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,e){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,e),e)}};function Ft(t,e=300){const[a,s]=h.exports.useState(t);return h.exports.useEffect(()=>{const n=setTimeout(()=>{s(t)},e);return()=>{clearTimeout(n)}},[t,e]),a}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,e){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,e),e)}};const Dt=(t,e)=>{switch(t){case f.SelectToken:return"Select token";case f.EnterAmount:return"Enter amount";case f.InsufficientBalance:return`Insufficient ${e?.coinFrom.symbol||""} balance`;case f.InsufficientAmount:return"Insufficient amount to swap";case f.InsufficientLiquidity:return"Insufficient liquidity";default:return"Swap"}},Rt=({swapState:t,previewAmount:e,slippage:a,balances:s})=>{if(t.direction===i.to){const n=ot(e||x,a,t.direction),o=M(s?.find(l=>l.assetId===t.coinFrom.assetId)?.amount||x);return n>o}return!1},$t=t=>{const{swapState:e,previewAmount:a,hasLiquidity:s}=t;return!e?.coinFrom||!e?.coinTo?f.SelectToken:e?.amount?a?!e.hasBalance||Rt(t)?f.InsufficientBalance:!s||X(a)?f.InsufficientLiquidity:f.Swap:f.InsufficientLiquidity:f.EnterAmount},_t=(t,e)=>t?.direction===i.to?t.coinTo.assetId===k?(t.amount||0)<(e?.eth_reserve||0):(t.amount||0)<(e?.token_reserve||0):!0;function zt(){const t=ft(),[e,a]=h.exports.useState(null),[s,n]=h.exports.useState(null),[o,l]=h.exports.useState(!0),r=Ft(s),{data:m}=Ct(),g=e?.amount||x,b=h.exports.useMemo(()=>({...m,...e,...s,previewAmount:g}),[m,e,s]),A=nt(),{data:S}=gt(),P=Y(D),{isLoading:u}=wt(["SwapPage-inactiveAmount",r?.amount?.toString(),r?.direction,r?.coinFrom.assetId,r?.coinTo.assetId],async()=>!r?.amount||!_t(r,m)?null:kt(t,r),{onSuccess:T=>{T==null?a(null):X(T.amount)?(a(null),l(!1)):(l(T.has_liquidity),a(T))}}),{mutate:p,isLoading:w}=dt(async()=>{!s||(await qt(t,s),await It(1e3))},{onSuccess:()=>{P(!0),yt.success("Swap made successfully!"),bt()}});function I(T){n(T)}const R=$t({swapState:s,balances:S,slippage:A.value,previewAmount:g,hasLiquidity:o}),rt=u||R!==f.Swap;return d(Z,{className:"sm:min-w-[450px]",children:[d(Z.Title,{children:[c(At,{className:"text-primary-500"}),"Swap"]}),c(Lt,{previewAmount:g,onChange:I,isLoading:u}),c(Mt,{isLoading:u,swapInfo:b}),c(Nt,{swapState:s,previewAmount:g,isLoading:u}),c(q,{isFull:!0,isLoading:w,size:"lg",variant:"primary",isDisabled:rt,onPress:()=>p(),children:Dt(R,s)})]})}export{zt as default};
