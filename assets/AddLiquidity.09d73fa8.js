import{G as z,a as M,b as p,O as P,u as G,c as S,d as U,r as v,C as F,e as W,f as B,g as Y,j as t,h as l,F as A,i as T,k as _,l as L,D as q,B as Q,m as J,S as K,n as D,t as w}from"./index.b957ffd4.js";function X(u){return z({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"g",attr:{},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M10 15.172l9.192-9.193 1.415 1.414L10 18l-6.364-6.364 1.414-1.414z"}}]}]})(u)}const Z=M(null),ee=M(null),C=(u,m)=>{const h=u||BigInt(0),g=m||BigInt(0),n=p(P*h)/p(g)/p(P);return Number.isNaN(n)||!Number.isFinite(n)?0:n},R={wrapper:"w-screen flex flex-1 items-center justify-center pb-14",content:"bg-gray-800 w-[30rem] rounded-2xl p-4 m-2",formHeader:"px-2 flex items-center justify-between font-semibold text-xl",info:"font-mono my-4 px-4 py-3 text-sm text-slate-400 decoration-1 border border-dashed border-white/10 rounded-lg",createPoolInfo:"font-mono my-4 px-4 py-3 text-sm text-slate-400 decoration-1 border border-dashed border-white/10 rounded-lg max-w-[400px]"};function te({loading:u,step:m,steps:h}){return t("ul",{className:"w-full rounded-lg border border-gray-600 text-gray-900",children:h.map((g,n)=>l("li",{className:J("space-between flex w-full items-center border-b border-gray-600 px-6 py-2 text-white",{"rounded-t-lg":n===0,"bg-primary-500":m===n&&u,"rounded-b-lg":n===h.length}),children:[t("div",{className:"flex-1",children:g}),m===n&&u&&t(K,{}),m>n&&t(X,{})]},n))})}function ae(){const u=G(),[m,h]=S(Z),[g,n]=S(ee),b=U(),[[f,d],N]=v.exports.useState([F[0],F[1]]),[$,x]=v.exports.useState(0),{data:c,refetch:k,isLoading:j}=W("PoolPage-poolInfo",()=>b.callStatic.get_info()),H=e=>{if(a.setAmount(e),o){const r=e||BigInt(0),i=Math.round(p(r)/o);s.setAmount(BigInt(i))}},O=e=>{if(s.setAmount(e),o){const r=e||BigInt(0),i=Math.round(p(r)*o);a.setAmount(BigInt(i))}},a=B({coin:f,disableWhenEth:!0,onChangeCoin:e=>N([e,d]),gasFee:BigInt(1),onChange:H}),s=B({coin:d,disableWhenEth:!0,onChangeCoin:e=>N([e,d]),onChange:O}),o=C(c?.eth_reserve,c?.token_reserve),V=C(c?.token_reserve,c?.eth_reserve),E=C(a.amount,s.amount),y=Y(async()=>{const e=a.amount,r=s.amount;!e||!r||(await b.functions.deposit({forward:[e,f.assetId]}),x(i=>i+1),await b.functions.deposit({forward:[r,d.assetId]}),x(i=>i+1),await b.functions.add_liquidity(1,r,1e3,{variableOutputs:1}),x(i=>i+1))},{onSuccess:()=>{w.success(o?"Added liquidity to the pool.":"New pool created."),a.setAmount(BigInt(0)),s.setAmount(BigInt(0))},onError:e=>{const r=e?.response?.errors;r?.length?r[0].message==="enough coins could not be found"&&w.error(`Not enough balance in your wallet to ${o?"add liquidity to":"create"} this pool.`):w.error(`Error when trying to ${o?"add liquidity to":"create"} this pool.`)},onSettled:async()=>{await k(),await u.refetch(),x(0)}});v.exports.useEffect(()=>{a.setAmount(m),s.setAmount(g)},[]),v.exports.useEffect(()=>{h(a.amount),n(s.amount)},[a.amount,s.amount]);const I=(()=>{const e=[];if(a.amount||e.push(`Enter ${f.name} amount`),s.amount||e.push(`Enter ${d.name} amount`),a.hasEnoughBalance||e.push(`Insufficient ${f.name} balance`),s.hasEnoughBalance||e.push(`Insufficient ${d.name} balance`),o){const r=o*(1-D),i=o*(1+D);(E<r||E>i)&&e.push("Entered ratio doesn't match pool")}return e})();return y.isLoading?t("div",{className:"mt-6 mb-8 flex justify-center",children:t(te,{steps:[`Deposit: ${f.name}`,`Deposit: ${d.name}`,"Provide liquidity","Done"],step:$,loading:y.isLoading,coinFrom:f,coinTo:d})}):l(A,{children:[t("div",{className:"mt-6 mb-4",children:t(T,{...a.getInputProps(),rightElement:t(_,{...a.getCoinSelectorProps()}),autoFocus:!0})}),t("div",{className:"mb-6",children:t(T,{...s.getInputProps(),rightElement:t(_,{...s.getCoinSelectorProps()})})}),c&&o?l("div",{className:R.info,children:[t("h4",{className:"text-white mb-2 font-bold",children:"Reserves"}),l("div",{className:"flex",children:[l("div",{className:"flex flex-col flex-1",children:[l("span",{children:["ETH:"," ",L.formatUnits(c.eth_reserve,q).toString()]}),l("span",{children:["DAI:"," ",L.formatUnits(c.token_reserve,q).toString()]})]}),c.eth_reserve>0&&c.token_reserve>0?l("div",{className:"flex flex-col",children:[t("span",{children:l(A,{children:["ETH/DAI: ",o.toFixed(6)]})}),t("span",{children:l(A,{children:["DAI/ETH: ",V.toFixed(6)]})})]}):null]})]}):null,t(Q,{isDisabled:!!I.length,isFull:!0,size:"lg",variant:"primary",onPress:I.length?void 0:()=>y.mutate(),children:I.length?I[0]:o?"Add liquidity":"Create liquidity"}),!o&&!j?l("div",{className:R.createPoolInfo,children:[t("h4",{className:"text-orange-400 mb-2 font-bold",children:"You are creating a new pool"}),t("div",{className:"flex",children:"You are the first to provide liquidity to this pool. The ratio between these tokens will set the price of this pool."})]}):null]})}export{ae as default};
